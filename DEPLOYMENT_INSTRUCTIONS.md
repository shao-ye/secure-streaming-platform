# çœŸå®ä»£ç†å»¶è¿Ÿæµ‹è¯•åŠŸèƒ½ - å®Œæ•´éƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²æ¦‚è¿°

æœ¬æ¬¡é‡æ„å®Œæˆäº†çœŸå®ä»£ç†å»¶è¿Ÿæµ‹è¯•åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š
- âœ… VPSç«¯ProxyManager.jsé‡æ„
- âœ… Cloudflare Workers APIé‡æ„  
- âœ… å‰ç«¯ProxyConfig.vueé‡æ„
- âœ… R2å­˜å‚¨ä¼˜åŒ–ï¼ˆæ¯ä¸ªproxyIdåªä¿ç•™æœ€æ–°è®°å½•ï¼‰
- âœ… VPSä¸€é”®éƒ¨ç½²è„šæœ¬

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### **ç¬¬ä¸€æ­¥: éƒ¨ç½²Cloudflare Workers**

#### 1.1 åˆ›å»ºR2å­˜å‚¨æ¡¶
```bash
# åœ¨Cloudflare Dashboardä¸­åˆ›å»ºR2å­˜å‚¨æ¡¶
# åç§°: proxy-test-history
# æˆ–ä½¿ç”¨å‘½ä»¤è¡Œ:
npx wrangler r2 bucket create proxy-test-history
```

#### 1.2 éƒ¨ç½²Workers
```bash
cd cloudflare-worker
npx wrangler deploy --env production
```

**æ³¨æ„**: å¦‚æœé‡åˆ°R2æƒé™é—®é¢˜ï¼Œè¯·åœ¨Cloudflare Dashboardä¸­æ‰‹åŠ¨åˆ›å»ºå­˜å‚¨æ¡¶ã€‚

### **ç¬¬äºŒæ­¥: éƒ¨ç½²å‰ç«¯ä»£ç **

#### 2.1 æ„å»ºå‰ç«¯
```bash
cd frontend
npm run build
```

#### 2.2 éƒ¨ç½²åˆ°Cloudflare Pages
- æ–¹æ³•1: é€šè¿‡Gitè‡ªåŠ¨éƒ¨ç½²
- æ–¹æ³•2: æ‰‹åŠ¨ä¸Šä¼ distç›®å½•

### **ç¬¬ä¸‰æ­¥: VPSéƒ¨ç½²**

#### 3.1 åœ¨VPSä¸Šæ‰§è¡Œä¸€é”®éƒ¨ç½²è„šæœ¬
```bash
# SSHåˆ°VPS
ssh root@<VPS_IP>

# ä¸‹è½½å¹¶æ‰§è¡Œéƒ¨ç½²è„šæœ¬
cd /tmp/github/secure-streaming-platform
git pull origin main
chmod +x vps-transcoder-api/deploy-vps.sh
./vps-transcoder-api/deploy-vps.sh
```

## ğŸ“ VPSä¸€é”®éƒ¨ç½²è„šæœ¬åŠŸèƒ½

è„šæœ¬ä½ç½®: `vps-transcoder-api/deploy-vps.sh`

### è„šæœ¬åŠŸèƒ½:
1. **GitåŒæ­¥**: ä» `/tmp/github/secure-streaming-platform` æ‹‰å–æœ€æ–°ä»£ç 
2. **æ–‡ä»¶æ›´æ–°**: å¤åˆ¶æœ€æ–°çš„VPS APIæ–‡ä»¶åˆ° `/opt/yoyo-transcoder`
3. **ä¾èµ–å®‰è£…**: æ›´æ–°Node.jsä¾èµ–åŒ…
4. **æœåŠ¡é‡å¯**: é‡å¯PM2æœåŠ¡ `vps-transcoder-api`
5. **çŠ¶æ€éªŒè¯**: æ£€æŸ¥æœåŠ¡çŠ¶æ€å’ŒAPIå¥åº·

### ä½¿ç”¨æ–¹æ³•:
```bash
# åœ¨VPSä¸Šæ‰§è¡Œ
cd /tmp/github/secure-streaming-platform
./vps-transcoder-api/deploy-vps.sh
```

## ğŸ”§ é…ç½®è¦æ±‚

### **Cloudflare Workersç¯å¢ƒå˜é‡**
```toml
[env.production.vars]
VPS_API_URL = "https://yoyo-vps.your-domain.com"
VPS_API_KEY = "your-api-key"

[[env.production.kv_namespaces]]
binding = "YOYO_USER_DB"
id = "your-kv-namespace-id"

[[env.production.r2_buckets]]
binding = "PROXY_TEST_HISTORY"
bucket_name = "proxy-test-history"
```

### **VPSç¯å¢ƒè¦æ±‚**
- âœ… Node.js >= 16.0.0
- âœ… PM2è¿›ç¨‹ç®¡ç†å™¨
- âœ… V2Ray/Xrayå®¢æˆ·ç«¯
- âœ… curlå‘½ä»¤è¡Œå·¥å…·

## ğŸ¯ é‡æ„å®Œæˆçš„åŠŸèƒ½

### **å®‰å…¨ç‰¹æ€§**
- âœ… IDæ˜ å°„é˜²æ­¢URLæ³¨å…¥æ”»å‡»
- âœ… å‰ç«¯å’Œåç«¯åŒé‡IDéªŒè¯
- âœ… å›ºå®šæµ‹è¯•ç½‘ç«™ç™½åå•ï¼ˆbaidu/googleï¼‰
- âœ… å¹¶å‘æµ‹è¯•é™åˆ¶ï¼ˆæœ€å¤š1ä¸ªï¼‰
- âœ… é¢‘ç‡é™åˆ¶ï¼ˆæ¯åˆ†é’Ÿæœ€å¤š20æ¬¡ï¼‰

### **æ€§èƒ½ç‰¹æ€§**
- âœ… 15ç§’è¿›ç¨‹çº§å¼ºåˆ¶è¶…æ—¶
- âœ… try-finallyèµ„æºæ¸…ç†ä¿è¯
- âœ… é¡µé¢åŠ è½½æ—¶çŠ¶æ€é‡ç½®
- âœ… R2å­˜å‚¨ä¼˜åŒ–ï¼ˆæ¯ä¸ªä»£ç†åªä¿ç•™æœ€æ–°è®°å½•ï¼‰

### **ç”¨æˆ·ä½“éªŒ**
- âœ… åªæ˜¾ç¤ºçœŸå®å»¶è¿Ÿï¼ˆå¦‚87msï¼‰æˆ–å¤±è´¥çŠ¶æ€ï¼ˆ-1ï¼‰
- âœ… æµ‹è¯•ç½‘ç«™ä¸‹æ‹‰é€‰æ‹©ï¼Œç”¨é€”è¯´æ˜æ¸…æ™°
- âœ… å®æ—¶æµ‹è¯•çŠ¶æ€æ˜¾ç¤ºï¼ˆæµ‹è¯•ä¸­...ï¼‰
- âœ… è¯¦ç»†çš„é”™è¯¯æç¤ºå’Œé™åˆ¶æé†’

## ğŸ§ª åŠŸèƒ½æµ‹è¯•

### **æµ‹è¯•æ­¥éª¤**
1. è®¿é—®ç®¡ç†é¡µé¢ä»£ç†é…ç½®
2. é€‰æ‹©æµ‹è¯•ç½‘ç«™ï¼ˆç™¾åº¦æ¨è/è°·æ­Œï¼‰
3. ç‚¹å‡»ä»»æ„ä»£ç†çš„"æµ‹è¯•"æŒ‰é’®
4. éªŒè¯æ˜¾ç¤ºçœŸå®å»¶è¿Ÿæˆ–-1
5. éªŒè¯å¹¶å‘é™åˆ¶å’Œé¢‘ç‡é™åˆ¶

### **é¢„æœŸç»“æœ**
- âœ… æœ‰æ•ˆä»£ç†æ˜¾ç¤ºçœŸå®å»¶è¿Ÿï¼ˆå¦‚ï¼š87msï¼‰
- âœ… æ— æ•ˆä»£ç†æ˜¾ç¤º-1
- âœ… åŒæ—¶åªèƒ½æµ‹è¯•ä¸€ä¸ªä»£ç†
- âœ… é¢‘ç‡è¿‡é«˜æ—¶æ˜¾ç¤ºè­¦å‘Š
- âœ… æµ‹è¯•ç½‘ç«™å¯ä»¥é€‰æ‹©ç™¾åº¦æˆ–è°·æ­Œ

## ğŸ” æ•…éšœæ’é™¤

### **å¸¸è§é—®é¢˜**

#### 1. VPSéƒ¨ç½²å¤±è´¥
```bash
# æ£€æŸ¥Gitç›®å½•
ls -la /tmp/github/secure-streaming-platform

# æ‰‹åŠ¨æ‹‰å–ä»£ç 
cd /tmp/github/secure-streaming-platform
git pull origin main

# æ£€æŸ¥PM2çŠ¶æ€
pm2 status
pm2 logs vps-transcoder-api
```

#### 2. ä»£ç†æµ‹è¯•ä¸€ç›´æ˜¾ç¤º-1
```bash
# æ£€æŸ¥VPSæœåŠ¡æ—¥å¿—
pm2 logs vps-transcoder-api --lines 50

# æ£€æŸ¥V2Ray/Xrayå®‰è£…
which v2ray
which xray

# æµ‹è¯•APIç«¯ç‚¹
curl http://localhost:52535/api/health
```

#### 3. Workerséƒ¨ç½²å¤±è´¥
```bash
# æ£€æŸ¥wrangleré…ç½®
npx wrangler whoami

# æ‰‹åŠ¨åˆ›å»ºR2å­˜å‚¨æ¡¶
# åœ¨Cloudflare Dashboardä¸­åˆ›å»º

# é‡æ–°éƒ¨ç½²
npx wrangler deploy --env production
```

## ğŸ“Š ç›‘æ§æŒ‡æ ‡

### **æˆåŠŸæŒ‡æ ‡**
- ğŸ¯ ä»£ç†æµ‹è¯•å‡†ç¡®ç‡ > 95%
- ğŸ¯ æµ‹è¯•å“åº”æ—¶é—´ < 15ç§’
- ğŸ¯ ç”¨æˆ·ä½“éªŒï¼šçœŸå®å»¶è¿Ÿæ˜¾ç¤º
- ğŸ¯ å®‰å…¨æ€§ï¼šæ— URLæ³¨å…¥é£é™©
- ğŸ¯ å­˜å‚¨ä¼˜åŒ–ï¼šæ¯ä¸ªä»£ç†åªä¿ç•™æœ€æ–°è®°å½•

### **KVå†™å…¥ä¼˜åŒ–**
- ğŸ“Š é¢„ä¼°KVå†™å…¥ï¼šçº¦100æ¬¡/å¤©ï¼ˆå‡å°‘93%ï¼‰
- ğŸ“Š R2å­˜å‚¨ï¼šæ¯ä¸ªä»£ç†ä¸€æ¡æœ€æ–°è®°å½•
- ğŸ“Š æˆæœ¬èŠ‚çœï¼šå¤§å¹…å‡å°‘å­˜å‚¨æˆæœ¬

## ğŸ“ æ›´æ–°æ—¥å¿—

### v2.0.0 - çœŸå®ä»£ç†å»¶è¿Ÿæµ‹è¯•é‡æ„
- âœ… å®Œå…¨é‡æ„æµ‹è¯•é€»è¾‘ï¼Œç§»é™¤é™çº§æœºåˆ¶
- âœ… æ·»åŠ IDæ˜ å°„å®‰å…¨æœºåˆ¶ï¼Œé˜²æ­¢URLæ³¨å…¥
- âœ… å®ç°R2å­˜å‚¨ä¼˜åŒ–ï¼Œæ¯ä¸ªä»£ç†åªä¿ç•™æœ€æ–°è®°å½•
- âœ… æ·»åŠ å¹¶å‘å’Œé¢‘ç‡é™åˆ¶æ§åˆ¶
- âœ… åˆ›å»ºVPSä¸€é”®éƒ¨ç½²è„šæœ¬
- âœ… ä¼˜åŒ–ç”¨æˆ·ä½“éªŒå’Œé”™è¯¯å¤„ç†

## ğŸ‰ éƒ¨ç½²å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] Cloudflare Workerséƒ¨ç½²æˆåŠŸ
- [ ] R2å­˜å‚¨æ¡¶åˆ›å»ºæˆåŠŸ
- [ ] å‰ç«¯ä»£ç éƒ¨ç½²æˆåŠŸ
- [ ] VPSä»£ç åŒæ­¥æˆåŠŸ
- [ ] VPSæœåŠ¡é‡å¯æˆåŠŸ
- [ ] ä»£ç†æµ‹è¯•åŠŸèƒ½æ­£å¸¸
- [ ] å¹¶å‘é™åˆ¶åŠŸèƒ½æ­£å¸¸
- [ ] é¢‘ç‡é™åˆ¶åŠŸèƒ½æ­£å¸¸
- [ ] æµ‹è¯•ç½‘ç«™é€‰æ‹©åŠŸèƒ½æ­£å¸¸

---

**éƒ¨ç½²å®Œæˆåï¼Œè¯·æŒ‰ç…§æµ‹è¯•æ­¥éª¤éªŒè¯æ‰€æœ‰åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œï¼**
